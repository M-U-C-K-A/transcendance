//   _____ _____ _   _______ _   _   ___  ___  ___ _____ _   _ _____
//  |_   _|  _  | | | | ___ \ \ | | / _ \ |  \/  ||  ___| \ | |_   _|
//    | | | | | | | | | |_/ /  \| |/ /_\ \| .  . || |__ |  \| | | |
//    | | | | | | | | |    /| . ` ||  _  || |\/| ||  __|| . ` | | |
//    | | \ \_/ / |_| | |\ \| |\  || | | || |  | || |___| |\  | | |
//    \_/  \___/ \___/\_| \_\_| \_/\_| |_/\_|  |_/\____/\_| \_/ \_/


model Tournament {
	id			Int			@id	@default(autoincrement())
	hostId		Int
	slot		Int			@default(4)
	winnerId	Int?
	tDate		DateTime	@default(now()) @map("TDate")

	host			UserInfo			@relation("HostedTournaments", fields: [hostId], references: [id])
	winner			UserInfo?			@relation("TournamentWins", fields: [winnerId], references: [id])
	participants	TournamentHistory[]

	@@map("Tournament")
}

model TournamentHistory {
	userId			Int
	tournamentId	Int

	user		UserInfo	@relation(fields: [userId], references: [id])
	tournament	Tournament	@relation(fields: [tournamentId], references: [id])

	@@id([userId, tournamentId])
	@@map("TournamentHistory")
}

//  ___  ___  ___ _____ _____  _   _
//  |  \/  | / _ \_   _/  __ \| | | |
//  | .  . |/ /_\ \| | | /  \/| |_| |
//  | |\/| ||  _  || | | |    |  _  |
//  | |  | || | | || | | \__/\| | | |
//  \_|  |_/\_| |_/\_/  \____/\_| |_/

model Match {
	id			Int			@id	@default(autoincrement())
	p1Id		Int
	p2Id		Int
	p1Elo		Int
	p2Elo		Int
	winnerId	Int?
	p1Score		Int			@default(0)
	p2Score		Int			@default(0)
	p1EloGain	Int
	p2EloGain	Int
	mDate		DateTime	@default(now()) @map("MDate")
	matchType MatchType

	player1		UserInfo		@relation("P1Matches", fields: [p1Id], references: [id])
	player2		UserInfo		@relation("P2Matches", fields: [p2Id], references: [id])
	winner		UserInfo?		@relation("WonMatches", fields: [winnerId], references: [id])
	matchHistory MatchHistory[]

	@@map("Match")
}

enum MatchType {
	Local
	Quickplay
	Custom
	Tournament
}


model MatchHistory {
	userId	Int
	matchId	Int

	user	UserInfo	@relation(fields: [userId], references: [id])
	match	Match		@relation(fields: [matchId], references: [id])

	@@id([userId, matchId])
	@@map("MatchHistory")
}
